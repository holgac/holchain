#!/usr/bin/env bash
# Usage: localdb [KEY [VALUE]]
DBFILE="$HOLCONFIGDIR/localdb.json"
if [ ! -f "$DBFILE" ]; then
  echo '{}' > "$DBFILE"
fi

if [ -z "$1" ]; then
  # Pretty-print everything on no input
  jq . < "$DBFILE"
elif [ -z "$2" ]; then
  # Get result on single input
  KEY=$(urlencode "$1")
  jq '.["'"$KEY"'"]' 2>&1 < "$DBFILE" | tr -d \" | urldecode && printf "\\n"
else
  # Set on two inputs
  KEY=$(urlencode "$1")
  VALUE=$(urlencode "$2")
  RES=$(jq -c '. + {"'"$KEY"'": "'"$VALUE"'"}' < "$DBFILE")
  echo "$RES" > "$DBFILE"
fi
